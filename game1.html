<!DOCTYPE html>

<html lang="en" class="no-js">
<style>
    body {
        margin: 0px;
        padding: 0px;
        background: #fff url(https://i.imgur.com/n6xR6R6.png) center center fixed no-repeat; //設定背景圖片的呈現方式
        background-size: cover; //設定背景圖片的填滿方式
    }
</style>

<head>
    <script src="https://unpkg.com/konva@4.2.2/konva.min.js"></script>
    <meta charset="utf-8" />
    <title>りゅうおうR/C工房--FT-17拼圖遊戲頁面</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="這是呂巍君的個人網站，裡面放了大學四年的作品" name="description" />
    <meta content="りゅうおう" name="author= ＲＹＵＯＵ" />
    <link href="http://fonts.googleapis.com/css?family=Hind:300,400,500,600,700" rel="stylesheet" type="text/css">

    <link href="vendor/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="css/animate.css" rel="stylesheet">
    <link href="vendor/swiper/css/swiper.min.css" rel="stylesheet" type="text/css" />
    <link href="css/layout.min.css" rel="stylesheet" type="text/css" />
    <link rel="shortcut icon" href="favicon.ico" />
</head>

<header class="header navbar-fixed-top">
    <nav class="navbar bhg" role="navigation">
        <div class="container">
            <div class="menu-container js_nav-item">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="toggle-icon"></span>
                </button>

                <div class="logo">
                    <a class="logo-wrap" href="index.html">
                        <img class="logo-img logo-img-main" src="https://i.imgur.com/hutbPX8.png"
                            alt="FlameOnePage Logo">
                        <img class="logo-img logo-img-active" src="https://i.imgur.com/mTzJPwY.png"
                            alt="FlameOnePage Dark Logo">
                    </a>
                </div>

            </div>


            <div class="collapse navbar-collapse nav-collapse">

                <!--div class="language-switcher">
					  <ul class="nav-lang">
                        <li><a class="active" href="#">EN</a></li>
					    <li><a href="#">DE</a></li>
						<li><a href="#">FR</a></li>
                      </ul>
                      <li class="footer-list-item"><a href="https://twitter.com/RYUOU12098"target="_blank" >Twitter</a></li>
					</div--->

                <div class="menu-container">
                    <ul class="nav navbar-nav navbar-nav-right">
                        <li class="js_nav-item nav-item">
                            <a class="nav-item-child nav-item-hover" href="experience.html">網頁學習心得</a>
                        </li>
                        <li class="js_nav-item nav-item">
                            <a class="nav-item-child nav-item-hover" href="networks.html">學習成品列表</a>
                        </li>
                        <li class="js_nav-item nav-item">
                            <a class="nav-item-child nav-item-hover" href="about.html">作者介紹</a>
                        </li>
                        <li class="js_nav-item nav-item">
                            <a class="nav-item-child nav-item-hover" href="works.html">作品一覽</a>
                        </li>
                        <li class="js_nav-item nav-item">
                            <a class="nav-item-child nav-item-hover" href="video.html">作品影片</a>
                        </li>
                        <li class="js_nav-item nav-item">
                            <a class="nav-item-child nav-item-hover" href="#contact">聯絡</a>
                        </li>

                    </ul>
                </div>
            </div>
        </div>
    </nav>
</header>




<div class="content-lg container bgoo">
    <div id="title"></div>
    <div class="row margin-b-40 bgo">
        <div class="col-sm-6">
            <h2>拼圖遊戲</h2>
            <p></p>
        </div>
    </div>
    <!--// end row -->
    <div class="masonry-grid-item col-xs-12 col-sm-6 col-md-12">
        <div class="justify-content-around">
            <span style="font-family:Arial, Helvetica, sans-serif;">
                <div class="center" id="container">

                </div>
            </span><br>
            <hr style="width: 100%; height: 4px ;border: none; background-color: rgba(116, 116, 116, 0.685);">
            <div class="col-sm-2"></div>
            <div class="col-sm-5">
                <h3 style="color: cornflowerblue;"><a href="javascript:window.location.reload()">重新整理</a></h3>
            </div>
            <div class="col-sm-3">
                <h3 style="color: cornflowerblue;"><a href="networks.html">回學習成品列表</a></h3>
            </div>
            <div class="col-sm-2"></div>
            <hr style="width: 100%; height: 4px ;border: none; background-color: rgba(116, 116, 116, 0.685);">
            <a href="https://soundeffect-lab.info" target="_blank">
                <h2>聲音素材來源:<h3>効果音ラボ<h6>フリー、商用無料、報告不用の効果音素材をダウンロード</h6>
                    </h3>
                </h2>
            </a>
            <audio id="pass">
                <source src="FT-17/クリック.mp3" type="audio/mpeg">

            </audio>


            </audio>
            <audio id="passfinal">
                <source src="FT-17/yokudekimashita.mp3" type="audio/mpeg">

            </audio>

            <div id="notes">
                <div class="container row col-md-12 margin-b-40 bgo ">
                    <h2>學習心得</h2>
                </div>
                <div class="container row col-md-12 margin-b-40">
                    <p></p>
                    <h3>這次所做的小遊戲是個類似拼圖的遊戲，因為這個構想，我就想說做類似立體的拼圖。但這樣一來遇到了問題，要立體的話就會有前後，但在經過測試，後放的物件必定在上面，因為移動時movetoTop了。
                    </h3>
                    </p>

                    <p>
                    <h3>於是想說改變物件屬性，但我不知道如何把單一個叫出來改就作罷。乾脆用填洞的方式來讓最下層的圖片顯示出來，但是了很久都只能讓移動的hide，黑洞卻無法hide。後來突然想到既然同檔名，那就分兩個部分讓程式找到檔名一致的藏起來就可以了。
                    </h3>
                    </p>

                    <p>
                    <h3>如此嘗試後就可以填洞了，剩下就是重新畫過我自己要的圖，抓我最後要顯示的座標。在測試時發現老師的程式碼沒有限制位置，物件可以跑出頁框外就再也回不來，所以加上了限制範圍。另外還發現背景圖是用疊的，再拼完後疊了第二張圖上去。
                    </h3>
                    </p>
                    <p>
                    <h3>在素材的使用上，圖是我自己畫的，而聲音音檔來源為：<a href="https://soundeffect-lab.info" target="_blank">効果音ラボ</a>。</h3>
                    </p>
                </div>
            </div>
        </div>
    </div>
    <script>
        var bkimage = ["background"]

        var parts = ["rsuspension", "tail", "chassis", "turret", "lsuspension", "flag"]  //檔名


        var paths = {

            rsuspension: {ex: 534, ey: 250 },   //這邊順序會影響一開始圖層順序
            tail: {ex: 950, ey: 192 },
            chassis: {ex: 600, ey: 175 },
            turret: { ex: 665, ey: 108 },
            lsuspension: {ex: 669, ey: 273 },
            flag: {ex: 792, ey: 25 },
        }
        var loadedImages = 0;

        function getRandomX(min, max) {
            min = 0;
            max=300;
            return Math.floor(Math.random() * (max - min + 1)) + min;
        };

        function getRandomY(min, max) {
            min = 50;
            max=260;
            return Math.floor(Math.random() * (max - min + 1)) + min;
        };

        loadImages(bkimage, parts, initStage)


        function loadImages(bgimg, fgimgs, callback) {
            var assetDir = 'FT-17/';                        //資料夾路徑
            var variants = ["", "_black", "_glow"];         //後綴
            var images = {};
            var sources = [bgimg]
            for (var i = 0; i < fgimgs.length; i++) {
                for (var j = 0; j < variants.length; j++) {
                    sources.push(fgimgs[i] + variants[j])
                }
            }
            var numImages = sources.length;
            for (var i = 0; i < sources.length; i++) {
                var src = sources[i]
                images[src] = new Image();
                images[src].src = assetDir + src + ".png";
                images[src].onload = function () {
                    if (++loadedImages >= numImages) {
                        callback(images);
                    }
                };
            }
        }

        function drawBackground(background, bgImg, text) {
            var context = background.getContext();
            context.drawImage(bgImg, 0, 0);   //背景圖片座標
            context.setAttr('font', '40pt Impact');  //改字體大小
            context.setAttr('textAlign', 'center');//改位置
            context.setAttr('fillStyle', 'White');//改樣式顏色
            context.fillText(text, background.getStage().width() / 7, 70);//改寬度高度
        }
        function isNearOutline(part, ex, ey) {
            var a = part;                         //吸引
            var ax = a.x();
            var ay = a.y();
            //吸引
            if (ax > ex - 25
                && ax < ex + 25
                && ay > ey - 25 && ay < ey + 25) {
                return true;
            } else {
                return false;
            }
        }



        function initStage(images) {
            var score = 0;
            var stage = new Konva.Stage({
                container: 'container',
                width: 1100,                 //遊戲頁框大小
                height: 520
            });
            var background = new Konva.Layer();                 //圖層
            var panzerLayer = new Konva.Layer();
            var finalposition = new Konva.Layer();
            var result = new Konva.Layer();

            for (var key in paths) { // key = monkey, lion, ...
                var setpart = function () {
                    var part = new Konva.Image({                //放置物體程式部分
                        image: images[key],
                        x: getRandomX(),
                        y: getRandomY(),

                        draggable: true,



                        dragBoundFunc: function (pos) {

                            var newX;
                            if (pos.x < 0) { newX = 0; }                   //限制物件移動的範圍(不會超出邊界)
                            else if (pos.x + part.width() > 1100) { newX = 1100 - part.width(); }
                            else { newX = pos.x; }
                            var newY;
                            if (pos.y < 0) { newY = 0; }
                            else if (pos.y + part.height() > 520) { newY = 520 - part.height(); }
                            else { newY = pos.y; }
                            return {
                                x: newX,
                                y: newY
                            };
                        }
                    });

                    var part2 = new Konva.Image({
                        image: images[key + "_black"],
                        x: paths[key].ex,
                        y: paths[key].ey,
                    });
                    finalposition.add(part2);
                    part2.setZIndex(0);


                    var privKey = key
                    part.on('mouseover', function () {
                        if (part.draggable() != false) {
                            part.image(images[privKey + '_glow']);//滑鼠在物件上
                            panzerLayer.draw();
                            document.body.style.cursor = 'pointer';//游標變化
                        } else {
                            part.image(images[privKey]);//滑鼠在物件上
                            panzerLayer.draw();
                            document.body.style.cursor = 'default';//游標變化
                        }

                    });
                    // return animal on mouseout
                    part.on('mouseout', function () {//滑鼠移開物件

                        if (part.draggable() != false) {
                            part.image(images[privKey]);
                            panzerLayer.draw();
                            document.body.style.cursor = 'default';//游標變化
                        } else {
                            part.image(images[privKey + '_glow']);
                            panzerLayer.draw();
                            document.body.style.cursor = 'default';//游標變化
                        }
                    });
                    part.on('dragstart', function () {
                        this.moveToTop();
                        panzerLayer.draw();
                    });
                    part.on('dragmove', function () {
                        document.body.style.cursor = 'pointer';//游標變化


                    });
                    /*
                     * check if animal is in the right spot and
                     * snap into place if it is
                     */
                    part.on('dragend', function () {
                        var home = paths[privKey]

                        if (!part.inRightPlace && isNearOutline(part, home.ex, home.ey)) {

                            part.position({
                                x: home.ex,
                                y: home.ey
                            });
                            part2.position({
                                x: home.ex,
                                y: home.ey
                            });
                            panzerLayer.draw();
                            finalposition.draw();
                            part.inRightPlace = true;
                            // disable drag and drop
                            if (++score >= 6) {
                                var x = document.getElementById("passfinal");
                                x.play();
                                var text1 = 'FT-17完成!!'
                                drawBackground(background, images.background, text1);
                            } else {
                                var x;
                                if (score == 1) {
                                    x = document.getElementById("pass");
                                    var text2 = '還有5個零件'
                                    drawBackground(background, images.background, text2);
                                }
                                else if (score == 2) {
                                    x = document.getElementById("pass");
                                    var text2 = '還有4個零件'
                                    drawBackground(background, images.background, text2);
                                }
                                else if (score == 3) {
                                    x = document.getElementById("pass");
                                    var text2 = '還有3個零件'
                                    drawBackground(background, images.background, text2);
                                }
                                else if (score == 4) {
                                    x = document.getElementById("pass");
                                    var text2 = '還有2個零件'
                                    drawBackground(background, images.background, text2);
                                }
                                else if (score == 5) {
                                    x = document.getElementById("pass");
                                    var text2 = '還有1個零件'
                                    drawBackground(background, images.background, text2);
                                }


                                x.play();
                            }
                            setTimeout(function () {
                                part.draggable(false);
                                part.hide();
                                part2.hide();
                                //finalposition.hide(); 藏整層黑色layer
                                panzerLayer.draw();
                                finalposition.draw();
                            }, 50);




                        }
                    });
                    panzerLayer.add(part); part.setZIndex(50);
                }
                setpart()


            }

            stage.add(background); //順序關係圖層高度 上面比較後面
            stage.add(finalposition);
            stage.add(panzerLayer);
            stage.add(result);

            drawBackground(
                background,
                images[bkimage],
                '完成FT-17吧!'
            );
        }

    </script>

</div>

</div>


</div>

<!-- Services -->
<div id="services">


</div>
</div>
<!-- End Service -->
</div>








<!--========== END PAGE LAYOUT ==========-->
<div id="contact">
    <!--========== FOOTER ==========-->
    <footer class="footer" style="background-color:rgb(255, 255, 255);opacity:0.8;">
        <!-- Links -->
        <div class="section-seperator">
            <div class="content-md container">
                <div class="row">
                    <div class="col-sm-2 sm-margin-b-30">
                        <!-- List -->
                        <ul class="list-unstyled footer-list">
                            <li class="footer-list-item"><a href="about.html">介紹</a></li>
                            <li class="footer-list-item"><a href="video.html">影片</a></li>
                            <li class="footer-list-item"><a href="works.html">作品</a></li>
                        </ul>
                        <!-- End List -->
                    </div>
                    <div class="col-sm-2 sm-margin-b-30">
                        <!-- List -->
                        <ul class="list-unstyled footer-list">
                            <li class="footer-list-item"><a href="https://twitter.com/RYUOU12098"
                                    target="_blank">Twitter</a></li>
                            <li class="footer-list-item"><a
                                    href="https://home.gamer.com.tw/homeindex.php?owner=inazuma106"
                                    target="_blank">巴哈姆特小屋</a></li>
                            <li class="footer-list-item"><a href="https://t.co/aQ4m3MbGAe?amp=1"
                                    target="_blank">YouTube</a></li>
                        </ul>
                        <!-- End List -->
                    </div>
                    <div class="col-sm-2 sm-margin-b-30">

                    </div>
                    <div class="col-sm-2 sm-margin-b-30">

                    </div>
                    <div class="col-sm-2 sm-margin-b-30">
                        <!-- List -->

                    </div>
                    <div class="col-sm-2 sm-margin-b-30">
                        <!-- List -->
                        <img class="img-responsive" src="https://i.imgur.com/x7acpSz.png" alt="Latest Products Image">
                        <!-- End List -->
                    </div>

                </div>
                <!--// end row -->
            </div>
        </div>
        <!-- End Links -->

        <!-- Copyright -->
        <div class="content container">
            <div class="row">
                <div class="col-xs-6">
                    <img class="footer-logo" src="https://i.imgur.com/gMNRTAW.png" alt="RYUOU Logo">
                </div>
                <div class="col-xs-6 text-right">
                    <p class="margin-b-0"><a class="fweight-700"></a> by: <a class="fweight-700">RYUOU Studio</a></p>
                </div>
            </div>
            <!--// end row -->
        </div>

        <!-- End Copyright -->

    </footer>
</div>

<!--========== END FOOTER ==========-->

<!-- Back To Top -->
<a href="javascript:void(0);" class="js-back-to-top back-to-top">TOP</a>

<!-- JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- CORE PLUGINS -->
<script src="vendor/jquery.min.js" type="text/javascript"></script>
<script src="vendor/jquery-migrate.min.js" type="text/javascript"></script>
<script src="vendor/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>

<!-- PAGE LEVEL PLUGINS -->
<script src="vendor/jquery.easing.js" type="text/javascript"></script>
<script src="vendor/jquery.back-to-top.js" type="text/javascript"></script>
<script src="vendor/jquery.smooth-scroll.js" type="text/javascript"></script>
<script src="vendor/jquery.wow.min.js" type="text/javascript"></script>
<script src="vendor/swiper/js/swiper.jquery.min.js" type="text/javascript"></script>
<script src="vendor/masonry/jquery.masonry.pkgd.min.js" type="text/javascript"></script>
<script src="vendor/masonry/imagesloaded.pkgd.min.js" type="text/javascript"></script>

<!-- PAGE LEVEL SCRIPTS -->
<script src="js/layout.min.js" type="text/javascript"></script>
<script src="js/components/wow.min.js" type="text/javascript"></script>
<script src="js/components/swiper.min.js" type="text/javascript"></script>
<script src="js/components/masonry.min.js" type="text/javascript"></script>

<style>
    .square {
        width: 235px;
        border-radius: 50%;
        border: 1px solid rgba(255, 255, 255, 0.8);
    }

    .center {
        margin: 0 auto;
        float: none;
    }

    .bgo {
        background: rgba(204, 203, 203, 0.6);
        margin-bottom: 10px;
    }

    .bgoo {
        background: rgba(255, 255, 255, 0.473);
        margin-bottom: 10px;
    }

    .bhg {
        background: rgba(15, 15, 12, 0.6);
        margin-bottom: 10px;
    }

    .bh1 {
        background: rgba(15, 15, 12, 0.0);
        margin-bottom: 10px;
    }
</style>
</body>
<!-- END BODY -->

</html>